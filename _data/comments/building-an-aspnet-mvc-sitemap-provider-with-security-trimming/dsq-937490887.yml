id: dsq-937490887
date: 2009-01-06T10:11:10.0000000+01:00
name: Rob Fearn
avatar: https://disqus.com/api/users/avatars/Rob Fearn.jpg
message: <p>Awesome Code just what I was looking for :-)</p><p>Just a quick note with the [Authorize] Action decoration, when the MvcSitemapProvider class processes the decorations it does not handle missing attributes correctly due to a simple split problem:</p><p>[Authorize(Roles="Admin")] does not work - you have to use [Authorize(Roles="Admin",Users="*")]</p><p>If you only add the Roles attribute without the Users attribute the menu will not display correctly as the Users attribute is treated as an empty String "" and the Split function converts this empty string into an Array of length 1 which means it gets processed once by the following loop and consequently fails:</p><p>foreach (string user in usersArray)<br>{<br>         if (user != "*" &amp;&amp; (principal.Identity.Name == "" || principal.Identity.Name != user)) return false;<br>}</p><p>If you change the split lines to the following it will sort out the problem:</p><p>// Determine if the current user is allowed to access the current node<br>char[] delimeter = {','};<br>string[] roleArray = roles.Split(delimeter,StringSplitOptions.RemoveEmptyEntries);<br>string[] usersArray = users.Split(delimeter,StringSplitOptions.RemoveEmptyEntries);</p><p>Thanks again for the great code :-)</p><p>Cheers<br>Rob</p>
