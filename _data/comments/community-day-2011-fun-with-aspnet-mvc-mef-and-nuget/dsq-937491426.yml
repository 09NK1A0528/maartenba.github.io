id: dsq-937491426
replyToId: dsq-937491260
date: 2011-07-29T22:12:41.0000000+02:00
name: Dadv
avatar: https://disqus.com/api/users/avatars/Dadv.jpg
message: '<p>Hi again,</p><p>I just look in the MefContrib.Mvc3 source code... everywhere you fond bin directory hard-coded :</p><p>public MvcApplicationRegistry()<br>{<br>base.Scan(delegate(ITypeScannerConfigurator x)<br>{<br>x.Assembly(Assembly.GetExecutingAssembly());<br>[b]x.Directory(Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "bin"));[/b]<br>}<br>);<br>base.Part().ForTypesAssignableFrom&lt;IController&gt;().MakeNonShared().AddMetadata(new PartCreationScopeAttribute(PartCreationScope.Default)).ExportAs&lt;IController&gt;().Export().Imports(delegate(IImportRegistry x)<br>{<br>x.Import().Members(delegate(Type m)<br>{<br>ConstructorInfo[] array = new ConstructorInfo[1];<br>array[0] = (m.GetConstructors().FirstOrDefault((ConstructorInfo c) =&gt; c.GetCustomAttributes(typeof(ImportingConstructorAttribute), false).Length &gt; 0) ?? m.GetGreediestConstructor());<br>return array;<br>}<br>);<br>x.Import().Members((Type m) =&gt; (<br>from mbr in m.GetMembers()<br>where mbr.GetCustomAttributes(typeof(ImportAttribute), false).Length &gt; 0<br>select mbr).ToArray&lt;MemberInfo&gt;());<br>}<br>);<br>}</p><p>///</p><p>public static void Bootstrap()<br>{<br>AggregateCatalog catalog = new AggregateCatalog(new ComposablePartCatalog[]<br>{<br>[b]new DirectoryCatalog("bin"), [/b]<br>new ConventionCatalog(new IPartRegistry&lt;IContractService&gt;[]<br>{<br>new MvcApplicationRegistry()<br>})<br>});<br>CompositionDependencyResolver compositionDependencyResolver = new CompositionDependencyResolver(catalog);<br>DependencyResolver.SetResolver(compositionDependencyResolver);<br>ControllerBuilder.Current.SetControllerFactory(new DefaultControllerFactory(new CompositionControllerActivator(compositionDependencyResolver)));<br>FilterProviders.Providers.Remove(FilterProviders.Providers.Single((IFilterProvider f) =&gt; f is FilterAttributeFilterProvider));<br>FilterProviders.Providers.Add(new CompositionFilterAttributeFilterProvider(compositionDependencyResolver));<br>ModelValidatorProviders.Providers.Remove(ModelValidatorProviders.Providers.OfType&lt;DataAnnotationsModelValidatorProvider&gt;().Single&lt;DataAnnotationsModelValidatorProvider&gt;());<br>ModelValidatorProviders.Providers.Add(new CompositionDataAnnotationsModelValidatorProvider(compositionDependencyResolver));<br>ModelBinderProviders.BinderProviders.Add(new CompositionModelBinderProvider(compositionDependencyResolver));<br>}</p><p>///</p><p>So i try to remove the bin declaration in AppStart_MefContribMVC3</p><p> var catalog = new AggregateCatalog(<br>               [b] //new DirectoryCatalog("bin"),[/b]<br>                new ConventionCatalog(new MvcApplicationRegistry())); // Note: add your own (convention)catalogs here if needed.</p><p>And... nothing append ... all work like previously.</p><p>So what the use of this "new DirectoryCatalog("bin")" here?<br>And why any other DirectoryCatalog are ignore ?</p><p>My goal is simple, i want to have in a "Plugins" directory a Plugin.dll File and a Views Directory</p><p>My Plugin.dll contain a DemoController.</p><p>My main mvc application contain a HomeController.</p><p>Now if i type /Home, i should see the Home View (/Views/Home/Index.cshtml)<br>If i type /Demo, i should see the Demo View (/Plugins/Views/Demo/Index.cshtml)</p><p>I know you blog about this, but your previous project where not using MefContrib.MVC3</p><p>If you could not help me about this, can you give me a link where i can find some help  please?</p><p>Thx a lot,</p><p>Dadv</p><p>ps: you can email me if necessary.</p>'
